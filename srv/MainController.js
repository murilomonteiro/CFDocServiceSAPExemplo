
const cds = require('@sap/cds')
const LOG = cds.log('srv')
const cmis = require('cmis');

class MainController extends cds.ApplicationService { init(){
    this.on ('listFolders', async (req, res) => {
        var session = new cmis.CmisSession('https://api-sdm-di.cfapps.br10.hana.ondemand.com/browser');
        
        // criar uma rotina para geração de token
        session.setToken('eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vY2Zob21vbG9ncmguYXV0aGVudGljYXRpb24uYnIxMC5oYW5hLm9uZGVtYW5kLmNvbS90b2tlbl9rZXlzIiwia2lkIjoiZGVmYXVsdC1qd3Qta2V5LS0yMjY0NDQ1ODAiLCJ0eXAiOiJKV1QifQ.eyJqdGkiOiJkZGU4ZTUwNmM0ZjI0MDgzOGNmMGM4ZWVmZDM5ZDZjZCIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiJlMTQyZjk0ZC01Mjk1LTRkZGYtOWMxNC02MGM3NWI5ZjNhYmIiLCJ6ZG4iOiJjZmhvbW9sb2dyaCIsInNlcnZpY2VpbnN0YW5jZWlkIjoiZmY2MTUzYzEtMmVjYi00NGY3LTgzMzItMDhhZDg3MjVkOTlkIn0sInN1YiI6InNiLWZmNjE1M2MxLTJlY2ItNDRmNy04MzMyLTA4YWQ4NzI1ZDk5ZCFiNjUwfHNkbS1kaS1Eb2N1bWVudE1hbmFnZW1lbnQtc2RtX2ludGVncmF0aW9uIWIxODUiLCJhdXRob3JpdGllcyI6WyJzZG0tZGktRG9jdW1lbnRNYW5hZ2VtZW50LXNkbV9pbnRlZ3JhdGlvbiFiMTg1LnNkbXVzZXIiLCJ1YWEucmVzb3VyY2UiLCJzZG0tZGktRG9jdW1lbnRNYW5hZ2VtZW50LXNkbV9pbnRlZ3JhdGlvbiFiMTg1LnNkbW1pZ3JhdGlvbmFkbWluIiwic2RtLWRpLURvY3VtZW50TWFuYWdlbWVudC1zZG1faW50ZWdyYXRpb24hYjE4NS5zZG1hZG1pbiJdLCJzY29wZSI6WyJzZG0tZGktRG9jdW1lbnRNYW5hZ2VtZW50LXNkbV9pbnRlZ3JhdGlvbiFiMTg1LnNkbXVzZXIiLCJ1YWEucmVzb3VyY2UiLCJzZG0tZGktRG9jdW1lbnRNYW5hZ2VtZW50LXNkbV9pbnRlZ3JhdGlvbiFiMTg1LnNkbWFkbWluIiwic2RtLWRpLURvY3VtZW50TWFuYWdlbWVudC1zZG1faW50ZWdyYXRpb24hYjE4NS5zZG1taWdyYXRpb25hZG1pbiJdLCJjbGllbnRfaWQiOiJzYi1mZjYxNTNjMS0yZWNiLTQ0ZjctODMzMi0wOGFkODcyNWQ5OWQhYjY1MHxzZG0tZGktRG9jdW1lbnRNYW5hZ2VtZW50LXNkbV9pbnRlZ3JhdGlvbiFiMTg1IiwiY2lkIjoic2ItZmY2MTUzYzEtMmVjYi00NGY3LTgzMzItMDhhZDg3MjVkOTlkIWI2NTB8c2RtLWRpLURvY3VtZW50TWFuYWdlbWVudC1zZG1faW50ZWdyYXRpb24hYjE4NSIsImF6cCI6InNiLWZmNjE1M2MxLTJlY2ItNDRmNy04MzMyLTA4YWQ4NzI1ZDk5ZCFiNjUwfHNkbS1kaS1Eb2N1bWVudE1hbmFnZW1lbnQtc2RtX2ludGVncmF0aW9uIWIxODUiLCJncmFudF90eXBlIjoiY2xpZW50X2NyZWRlbnRpYWxzIiwicmV2X3NpZyI6ImRlMDJjZGQiLCJpYXQiOjE2MzUxMjk0MDYsImV4cCI6MTYzNTE3MjYwNiwiaXNzIjoiaHR0cHM6Ly9jZmhvbW9sb2dyaC5hdXRoZW50aWNhdGlvbi5icjEwLmhhbmEub25kZW1hbmQuY29tL29hdXRoL3Rva2VuIiwiemlkIjoiZTE0MmY5NGQtNTI5NS00ZGRmLTljMTQtNjBjNzViOWYzYWJiIiwiYXVkIjpbInNkbS1kaS1Eb2N1bWVudE1hbmFnZW1lbnQtc2RtX2ludGVncmF0aW9uIWIxODUiLCJ1YWEiLCJzYi1mZjYxNTNjMS0yZWNiLTQ0ZjctODMzMi0wOGFkODcyNWQ5OWQhYjY1MHxzZG0tZGktRG9jdW1lbnRNYW5hZ2VtZW50LXNkbV9pbnRlZ3JhdGlvbiFiMTg1Il19.ciZJ_qLvsZoHIw_OMJqRp7oGNVKaiCcZBCARrr3bNbaRAdyVo83tYITmI_gto_pNxySfpZahuZDktl8xbiiOz6vEdoHqXWp1ZVc-Uoh-PYvxtM2GkbuDlMciuAwFdHz-C0d81VOUZC3nE--k38TZIuhdpYlLKvUQ4uzw1e1KQDPzsklBjYTpVTW0-zHNW5U4_BS8KdQqdv9oCAsjAm3OyJ00cRwK3E0Dx9VP2SwX96xRaU4bP1j0vKlLE_OsQjQYKrxieg4G2jqr474DeuP8wRdyOiDS6ur3UhoVYa9Exccbyh0K5qocj1nC2jF1__HLzODOVUo-_D-6QcqpauaWtg')
            
        await session.loadRepositories()
        const results = await session.query('SELECT cmis:objectId, cmis:name, cmis:contentStreamLength FROM cmis:document');
        LOG.info(results);
        return results;
    })
}}

module.exports = { MainController }